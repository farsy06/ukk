<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2>Daftar Alat Tersedia</h2>
                <p class="text-muted mb-0">Pilih alat yang ingin Anda pinjam.</p>
            </div>
            <div class="text-end">
                <span class="badge bg-info">
                    <i class="fas fa-box"></i> Total: <%= alat ? alat.length : 0 %> alat
                </span>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="d-flex gap-2">
                <div class="input-group" style="width: 300px;">
                    <input type="text" class="form-control" id="searchInput" placeholder="Cari alat...">
                    <button class="btn btn-outline-secondary" type="button" id="clearSearch">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <select class="form-select" id="kategoriFilter" style="width: 200px;">
                    <option value="">Semua Kategori</option>
                    <% if (typeof kategori !== 'undefined' && kategori) { %>
                        <% kategori.forEach(function(kat) { %>
                            <option value="<%= kat.id %>"><%= kat.nama_kategori %></option>
                        <% }); %>
                    <% } %>
                </select>
            </div>
            <div>
                <span class="badge bg-success">
                    <i class="fas fa-check-circle"></i> Tersedia
                </span>
                <span class="badge bg-warning ms-2">
                    <i class="fas fa-exclamation-triangle"></i> Rusak Ringan
                </span>
                <span class="badge bg-danger ms-2">
                    <i class="fas fa-times-circle"></i> Rusak Berat
                </span>
            </div>
        </div>
    </div>
</div>

<div class="row" id="alatGrid">
    <% if (typeof alat !== 'undefined' && alat && alat.length > 0) { %>
        <% alat.forEach(function(item) { %>
            <div class="col-md-4 mb-4" data-id="<%= item.id %>" data-nama="<%= item.nama_alat %>" data-kategori="<%= item.kategori ? item.kategori.id : '' %>" data-kondisi="<%= item.kondisi %>" data-status="<%= item.status %>">
                <div class="card h-100 shadow-sm border-0">
                    <div class="position-relative">
                        <% if (item.foto) { %>
                            <img src="<%= item.foto %>" alt="Foto Alat" class="card-img-top" style="height: 200px; object-fit: cover;">
                        <% } else { %>
                            <div class="bg-secondary text-white d-flex align-items-center justify-content-center" style="height: 200px;">
                                <i class="fas fa-camera fa-3x"></i>
                            </div>
                        <% } %>
                        <div class="position-absolute top-0 end-0 m-2">
                            <% if (item.status === 'tersedia') { %>
                                <span class="badge bg-success">Tersedia</span>
                            <% } else if (item.status === 'dipinjam') { %>
                                <span class="badge bg-warning">Dipinjam</span>
                            <% } else if (item.status === 'maintenance') { %>
                                <span class="badge bg-secondary">Maintenance</span>
                            <% } %>
                        </div>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">
                            <%= item.nama_alat %>
                            <% if (item.deskripsi) { %>
                                <i class="fas fa-info-circle text-muted ms-2" data-bs-toggle="tooltip" data-bs-placement="top" title="<%= item.deskripsi %>"></i>
                            <% } %>
                        </h5>
                        <p class="card-text">
                            <small class="text-muted">
                                <i class="fas fa-layer-group"></i> 
                                Kategori: <%= item.kategori ? item.kategori.nama_kategori : 'Tidak ada kategori' %>
                            </small>
                            <br>
                            <small class="text-muted">
                                <i class="fas fa-box"></i> 
                                Stok: 
                                <span class="badge <%= item.stok > 5 ? 'bg-success' : item.stok > 0 ? 'bg-warning' : 'bg-danger' %>">
                                    <%= item.stok %>
                                </span>
                            </small>
                            <br>
                            <small class="text-muted">
                                <i class="fas fa-heartbeat"></i> 
                                Kondisi: 
                                <% if (item.kondisi === 'baik') { %>
                                    <span class="badge bg-success">
                                        <i class="fas fa-check-circle"></i> Baik
                                    </span>
                                <% } else if (item.kondisi === 'rusak_ringan') { %>
                                    <span class="badge bg-warning">
                                        <i class="fas fa-exclamation-triangle"></i> Rusak Ringan
                                    </span>
                                <% } else if (item.kondisi === 'rusak_berat') { %>
                                    <span class="badge bg-danger">
                                        <i class="fas fa-times-circle"></i> Rusak Berat
                                    </span>
                                <% } %>
                            </small>
                        </p>
                    </div>
                    <div class="card-footer bg-transparent border-0">
                        <div class="d-grid">
                            <% if (item.status === 'tersedia' && item.stok > 0) { %>
                                <a href="/peminjaman/ajukan/<%= item.id %>" class="btn btn-primary">
                                    <i class="fas fa-hand-holding"></i> Ajukan Peminjaman
                                </a>
                            <% } else if (item.status === 'maintenance') { %>
                                <button class="btn btn-secondary" disabled>
                                    <i class="fas fa-wrench"></i> Sedang Maintenance
                                </button>
                            <% } else if (item.stok === 0) { %>
                                <button class="btn btn-warning" disabled>
                                    <i class="fas fa-exclamation-triangle"></i> Stok Habis
                                </button>
                            <% } else { %>
                                <button class="btn btn-info" disabled>
                                    <i class="fas fa-handshake"></i> Sedang Dipinjam
                                </button>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        <% }); %>
    <% } else { %>
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                    <h5 class="card-title text-muted">Tidak ada alat yang tersedia</h5>
                    <p class="card-text text-muted">Saat ini tidak ada alat yang tersedia untuk dipinjam.</p>
                    <a href="/alat" class="btn btn-primary">
                        <i class="fas fa-refresh"></i> Muat Ulang
                    </a>
                </div>
            </div>
        </div>
    <% } %>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-info-circle"></i> Informasi Peminjaman</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-clock"></i> Peraturan Peminjaman</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-check text-success"></i> Maksimal peminjaman 7 hari</li>
                            <li><i class="fas fa-check text-success"></i> Harap periksa kondisi alat sebelum meminjam</li>
                            <li><i class="fas fa-check text-success"></i> Kembalikan alat dalam kondisi baik</li>
                            <li><i class="fas fa-check text-success"></i> Denda keterlambatan: Rp 5.000/hari</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-shield-alt"></i> Kondisi Alat</h6>
                        <ul class="list-unstyled">
                            <li><span class="badge bg-success"><i class="fas fa-check-circle"></i> Baik</span> - Alat dalam kondisi sempurna</li>
                            <li><span class="badge bg-warning"><i class="fas fa-exclamation-triangle"></i> Rusak Ringan</span> - Masih dapat digunakan</li>
                            <li><span class="badge bg-danger"><i class="fas fa-times-circle"></i> Rusak Berat</span> - Tidak dapat digunakan</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');
        const kategoriFilter = document.getElementById('kategoriFilter');
        const alatGrid = document.getElementById('alatGrid');
        const cards = alatGrid.querySelectorAll('.col-md-4');

        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Search functionality
        if (searchInput) {
            searchInput.addEventListener('input', filterAlat);
        }

        // Clear search functionality
        if (clearSearch) {
            clearSearch.addEventListener('click', function() {
                searchInput.value = '';
                kategoriFilter.value = '';
                filterAlat();
            });
        }

        // Category filter functionality
        if (kategoriFilter) {
            kategoriFilter.addEventListener('change', filterAlat);
        }

        function filterAlat() {
            const searchTerm = searchInput.value.toLowerCase().trim();
            const selectedKategori = kategoriFilter.value;

            cards.forEach(card => {
                const nama = card.getAttribute('data-nama').toLowerCase();
                const kategori = card.getAttribute('data-kategori');
                const kondisi = card.getAttribute('data-kondisi');
                const status = card.getAttribute('data-status');
                
                const matchesSearch = nama.includes(searchTerm);
                const matchesKategori = !selectedKategori || kategori === selectedKategori;
                
                const matches = matchesSearch && matchesKategori;
                
                card.style.display = matches ? '' : 'none';
            });
        }

        // Add hover effects for better UX
        cards.forEach(card => {
            const btn = card.querySelector('.btn');
            if (btn && !btn.disabled) {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-5px)';
                    this.style.transition = 'transform 0.3s ease';
                    this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.1)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                    this.style.boxShadow = 'none';
                });
            }
        });

        // Add keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && searchInput.value) {
                searchInput.value = '';
                kategoriFilter.value = '';
                filterAlat();
            }
        });

        // Add loading state for buttons
        const actionButtons = document.querySelectorAll('.btn-primary');
        actionButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memproses...';
                this.disabled = true;
                
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.disabled = false;
                }, 1000);
            });
        });
    });
</script>