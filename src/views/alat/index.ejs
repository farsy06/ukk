<section class="row mb-4">
    <div class="col-12">
        <div class="peminjam-hero">
            <div class="d-flex flex-wrap align-items-start justify-content-between gap-3">
                <div>
                    <h2 class="mb-1">Daftar Alat Tersedia</h2>
                    <p class="text-muted mb-0">Temukan alat berdasarkan nama dan kategori, lalu ajukan peminjaman dalam satu langkah.</p>
                </div>
                <div class="peminjam-hero-badge">
                    <i class="fas fa-boxes-stacked me-2"></i>
                    <span>Total: <%= range ? range.total : (alat ? alat.length : 0) %> alat</span>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="row mb-4">
    <div class="col-12">
        <div class="peminjam-toolbar">
            <div class="d-flex flex-wrap gap-2 align-items-center">
                <div class="input-group peminjam-search">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" id="alatSearchInput" placeholder="Cari nama alat...">
                    <button class="btn btn-outline-secondary" type="button" id="alatSearchClear" aria-label="Hapus pencarian">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <select class="form-select peminjam-kategori" id="alatKategoriFilter" aria-label="Filter kategori">
                    <option value="">Semua Kategori</option>
                    <% if (kategori && kategori.length) { %>
                        <% kategori.forEach((kat) => { %>
                            <option value="<%= kat.id %>"><%= kat.nama_kategori %></option>
                        <% }); %>
                    <% } %>
                </select>
            </div>

            <div class="d-flex flex-wrap gap-2">
                <span class="badge bg-success-subtle text-success border border-success-subtle">Tersedia</span>
                <span class="badge bg-warning-subtle text-warning border border-warning-subtle">Rusak Ringan</span>
                <span class="badge bg-danger-subtle text-danger border border-danger-subtle">Rusak Berat</span>
            </div>
        </div>
    </div>
</section>

<section class="row g-4" id="alatGrid">
    <% if (alat && alat.length > 0) { %>
        <% alat.forEach((item) => { %>
            <div
                class="col-md-6 col-xl-4 alat-item"
                data-nama="<%= item.nama_alat %>"
                data-kategori="<%= item.kategori ? item.kategori.id : '' %>"
            >
                <article class="peminjam-card h-100">
                    <div class="peminjam-card-media">
                        <% if (item.foto) { %>
                            <img src="<%= item.foto %>" alt="Foto <%= item.nama_alat %>" class="img-fluid">
                        <% } else { %>
                            <div class="peminjam-card-placeholder">
                                <i class="fas fa-camera"></i>
                            </div>
                        <% } %>
                        <div class="peminjam-card-status">
                            <% if (item.status === 'tersedia') { %>
                                <span class="badge bg-success-subtle text-success border border-success-subtle">Tersedia</span>
                            <% } else if (item.status === 'dipinjam') { %>
                                <span class="badge bg-warning-subtle text-warning border border-warning-subtle">Dipinjam</span>
                            <% } else { %>
                                <span class="badge bg-secondary-subtle text-secondary border border-secondary-subtle">Maintenance</span>
                            <% } %>
                        </div>
                    </div>

                    <div class="peminjam-card-body">
                        <div class="d-flex align-items-center justify-content-between gap-2">
                            <h5 class="mb-0"><%= item.nama_alat %></h5>
                            <% if (item.deskripsi) { %>
                                <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="tooltip" title="<%= item.deskripsi %>">
                                    <i class="fas fa-info-circle"></i>
                                </button>
                            <% } %>
                        </div>

                        <p class="text-muted small mt-2 mb-3">
                            <i class="fas fa-layer-group me-1"></i>
                            <%= item.kategori ? item.kategori.nama_kategori : "Tanpa kategori" %>
                        </p>

                        <div class="d-flex flex-wrap gap-2 mb-3">
                            <span class="badge <%= item.stok > 5 ? 'bg-success-subtle text-success border border-success-subtle' : item.stok > 0 ? 'bg-warning-subtle text-warning border border-warning-subtle' : 'bg-danger-subtle text-danger border border-danger-subtle' %>">
                                Stok: <%= item.stok %>
                            </span>
                            <% if (item.kondisi === 'baik') { %>
                                <span class="badge bg-success-subtle text-success border border-success-subtle">Baik</span>
                            <% } else if (item.kondisi === 'rusak_ringan') { %>
                                <span class="badge bg-warning-subtle text-warning border border-warning-subtle">Rusak Ringan</span>
                            <% } else { %>
                                <span class="badge bg-danger-subtle text-danger border border-danger-subtle">Rusak Berat</span>
                            <% } %>
                        </div>

                        <div class="d-grid">
                            <% if (item.status === 'tersedia' && item.stok > 0) { %>
                                <a href="/peminjaman/ajukan/<%= item.id %>" class="btn btn-primary peminjam-action-btn">
                                    <i class="fas fa-hand-holding me-1"></i> Ajukan Peminjaman
                                </a>
                            <% } else if (item.status === 'maintenance') { %>
                                <button class="btn btn-outline-secondary" disabled>
                                    <i class="fas fa-wrench me-1"></i> Sedang Maintenance
                                </button>
                            <% } else if (item.stok === 0) { %>
                                <button class="btn btn-outline-warning" disabled>
                                    <i class="fas fa-ban me-1"></i> Stok Habis
                                </button>
                            <% } else { %>
                                <button class="btn btn-outline-info" disabled>
                                    <i class="fas fa-clock me-1"></i> Sedang Dipinjam
                                </button>
                            <% } %>
                        </div>
                    </div>
                </article>
            </div>
        <% }); %>
    <% } else { %>
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted mb-2">Tidak ada alat tersedia</h5>
                    <p class="text-muted mb-4">Silakan kembali beberapa saat lagi atau hubungi petugas.</p>
                    <a href="/alat" class="btn btn-primary"><i class="fas fa-rotate-right me-1"></i>Refresh</a>
                </div>
            </div>
        </div>
    <% } %>
</section>

<% if (pagination && pagination.totalPages > 1) { %>
<section class="row mt-4">
    <div class="col-12">
        <nav aria-label="Navigasi halaman alat">
            <ul class="pagination justify-content-center">
                <% if (pagination.hasPrev) { %>
                    <li class="page-item">
                        <a class="page-link" href="/alat?page=<%= pagination.page - 1 %>">&laquo;</a>
                    </li>
                <% } else { %>
                    <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
                <% } %>

                <% const startPage = Math.max(1, pagination.page - 2); %>
                <% const endPage = Math.min(pagination.totalPages, pagination.page + 2); %>
                <% for (let i = startPage; i <= endPage; i++) { %>
                    <li class="page-item <%= i === pagination.page ? 'active' : '' %>">
                        <% if (i === pagination.page) { %>
                            <span class="page-link"><%= i %></span>
                        <% } else { %>
                            <a class="page-link" href="/alat?page=<%= i %>"><%= i %></a>
                        <% } %>
                    </li>
                <% } %>

                <% if (pagination.hasNext) { %>
                    <li class="page-item">
                        <a class="page-link" href="/alat?page=<%= pagination.page + 1 %>">&raquo;</a>
                    </li>
                <% } else { %>
                    <li class="page-item disabled"><span class="page-link">&raquo;</span></li>
                <% } %>
            </ul>
        </nav>
        <p class="text-center text-muted small mb-0">
            Menampilkan <%= range ? range.start : 0 %> - <%= range ? range.end : 0 %> dari <%= range ? range.total : 0 %> alat
        </p>
    </div>
</section>
<% } %>

<section class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-circle-info me-2"></i>Informasi Peminjaman</h6>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <ul class="mb-0 ps-3">
                            <li>Maksimal peminjaman 7 hari.</li>
                            <li>Denda keterlambatan Rp <%= overdueFinePerDayFormatted %> per hari.</li>
                            <li>Periksa kondisi alat sebelum meminjam.</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="mb-0 ps-3">
                            <li>Kembalikan alat sesuai jadwal.</li>
                            <li>Laporkan insiden kerusakan saat pengembalian.</li>
                            <li>Upload bukti pembayaran denda jika diperlukan.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script src="/js/alat-index.js"></script>
